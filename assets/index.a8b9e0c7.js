import{d as T,y as W,o as w,a as S,b as a,c as r,g as f,bX as ht,N as z,ao as H,j as n,r as u,J as dt,eU as _t,D as N,H as R,dj as mt,bZ as Ut,U as P,x as V,l as D,eV as vt,eW as yt,c5 as gt,b_ as wt,_ as St}from"./index.954a2cbc.js";import{L as bt}from"./layout3.feba5a7a.js";import{H as p}from"./http.2276b1a3.js";import{a as xt}from"./browser.b44e01a3.js";import{S as Ct,c as $t,d as kt,e as At,f as Lt,g as Pt}from"./api.f5801a4e.js";import"./axios.ee048d55.js";const Vt=T({__name:"iconCopy",props:{contents:null},emits:["afterCopy"],setup(b,{emit:x}){const C=b,{t:U}=W();function s(){z.writeTextToClipboard(C.contents),H.success(U("common.copySuccess")),x("afterCopy")}return(l,h)=>{const d=n("a-button");return w(),S(d,{type:"ghost",onClick:s},{icon:a(()=>[r(f(ht))]),_:1})}}}),Dt={class:"shortUrls"},Ht=["src","alt"],Bt={class:"shortUrls-item-container"},Ot=T({__name:"index",props:{clipboardValue:null,renderOnSearch:{type:Boolean}},emits:["acceptClipboardCb"],setup(b,{emit:x}){const C=b,{t:U}=W(),s=u("fetching"),l=u({title:"",longUrl:"",shortUrlSuffix:""}),h=u(""),d=u([]),_=u("fetching");function G(t){I(t)}function Z(){l.value.longUrl="",l.value.shortUrlSuffix="",l.value.title=""}dt(async()=>{var e;const t=(e=C.clipboardValue)==null?void 0:e.getOriginData();t&&_t(t)&&(l.value.longUrl=t,x("acceptClipboardCb"));try{s.value="fetching",await M(),await k(),s.value="success"}catch{s.value="error"}await $()});async function I(t){try{await et(t.longUrl,{title:t.title}),Z(),k(),await $()}catch(e){H.error("failed to create short URL"),console.error(e)}}async function j(t){try{await at(t.key),await $()}catch(e){H.error("failed to delete short URL"),console.error(e)}}function E(t){t.deleteVisible=!1}async function $(){_.value="fetching";try{const t=await rt();d.value=[],d.value=await Promise.all(t.map(async e=>{const i=await X(e.suffix),c=B(i);return{key:e.id,title:e.title?e.title:e.redirectUrl,suffix:e.suffix,redirectUrl:e.redirectUrl,shortUrl:i,shortUrlWithScheme:c,createdAt:new Date(e.createdAt).toDateString(),deleteVisible:!1,qrcodeUrl:await xt(c)}})),_.value="success"}catch(t){_.value="error",console.error(t)}}async function M(){const{scheme:t,host:e}=await O();m.value=t,A.value=e}async function k(){const t=await tt();l.value.shortUrlSuffix=t}async function J(t,e){if(e==="")throw U("shortUrl.emptyLongUrl");if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(e))throw U("shortUrl.wrongLongUrl")}const m=u(""),A=u("");N(()=>m.value,t=>{h.value=t+"://"+A.value+"/"}),N(()=>A.value,t=>{h.value=m.value+"://"+t+"/"});async function Q(t){t=B(t);try{await z.openBrowser(t)}catch{console.error("failed")}}function B(t=""){return t.startsWith("http")||(m.value!==""?t=m.value+"://"+t:t="http://"+t),t}async function X(t){return await O()+"/"+t}async function O(){const t=await K(),e=await Y();return{scheme:t,host:e}}async function K(){return await p.get(Ct)}async function Y(){return await p.get($t)}async function tt(){return await p.get(kt)}async function et(t,e){return await p.post(Lt,{redirect_url:t,suffix:e==null?void 0:e.suffix,title:e==null?void 0:e.title})}async function rt(){return await p.get(At)}async function at(t){return await p.delete(Pt.replace(":id",t.toString()))}return(t,e)=>{const i=n("a-alert"),c=n("a-input"),v=n("a-form-item"),L=n("a-col"),y=n("a-button"),ot=n("a-row"),nt=n("a-input-group"),lt=n("a-form"),q=n("a-spin"),st=n("a-avatar"),F=n("a-popover"),it=n("a-typography-link"),ct=n("a-popconfirm"),ut=n("a-list-item-meta"),ft=n("a-list-item"),pt=n("a-list");return w(),S(f(bt),{"left-width":400,class:"layout"},{one:a(()=>[r(q,{spinning:s.value==="fetching"},{default:a(()=>[s.value==="error"?(w(),S(i,{key:0,type:"error",message:t.$t("shortUrl.initError")},null,8,["message"])):R("",!0),r(lt,{model:l.value,layout:"vertical",onFinish:G},{default:a(()=>[r(v,{name:"longUrl",label:t.$t("shortUrl.longUrl"),rules:[{required:!0,validator:J,trigger:"blur"}]},{default:a(()=>[r(c,{value:l.value.longUrl,"onUpdate:value":e[0]||(e[0]=o=>l.value.longUrl=o),placeholder:"https://he3.app/"},null,8,["value"])]),_:1},8,["label","rules"]),r(v,{name:"shortUrlSuffix",label:t.$t("shortUrl.shortUrl"),rules:[{required:!1}]},{default:a(()=>[r(nt,null,{default:a(()=>[r(ot,{gutter:5},{default:a(()=>[r(L,{span:12},{default:a(()=>[r(c,{value:h.value,"onUpdate:value":e[1]||(e[1]=o=>h.value=o),readonly:""},null,8,["value"])]),_:1}),r(L,{span:9},{default:a(()=>[r(c,{value:l.value.shortUrlSuffix,"onUpdate:value":e[2]||(e[2]=o=>l.value.shortUrlSuffix=o),readonly:""},null,8,["value"])]),_:1}),r(L,{span:3},{default:a(()=>[r(y,{shape:"circle",onClick:e[3]||(e[3]=o=>k())},{icon:a(()=>[r(f(mt))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),Ut(r(v,{name:"title",label:t.$t("shortUrl.title"),rules:[{required:!1}]},{default:a(()=>[r(c,{value:l.value.title,"onUpdate:value":e[4]||(e[4]=o=>l.value.title=o)},null,8,["value"])]),_:1},8,["label"]),[[wt,!1]]),r(v,null,{default:a(()=>[r(y,{type:"primary","html-type":"submit"},{default:a(()=>[P(V(t.$t("shortUrl.submit")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])]),two:a(()=>[r(q,{spinning:_.value==="fetching"},{default:a(()=>[_.value==="error"?(w(),S(i,{key:0,type:"error",message:t.$t("shortUrl.getListError")},null,8,["message"])):R("",!0),D("div",Dt,[r(pt,{"data-source":d.value,"item-layout":"horizontal",class:"shortUrls-item"},{renderItem:a(({item:o})=>[r(ft,null,{default:a(()=>[r(ut,null,{avatar:a(()=>[r(F,null,{content:a(()=>[D("img",{src:o.qrcodeUrl,alt:t.$t("shortUrl.qrcodeAlt")},null,8,Ht)]),default:a(()=>[r(st,null,{icon:a(()=>[r(f(vt))]),_:1})]),_:2},1024)]),title:a(()=>[D("div",Bt,[r(it,{class:"shortUrls-item-short",onClick:g=>Q(o.shortUrl)},{default:a(()=>[P(V(o.shortUrl),1)]),_:2},1032,["onClick"]),r(f(Vt),{class:"shortUrls-item-copy",contents:o.shortUrlWithScheme},null,8,["contents"]),r(F,{visible:o.deleteVisible,"onUpdate:visible":g=>o.deleteVisible=g,trigger:"click",class:"shortUrls-item-more"},{content:a(()=>[r(ct,{title:t.$t("shortUrl.deletePopup"),"ok-text":t.$t("common.confirm"),"cancel-text":t.$t("common.cancel"),placement:"left",onConfirm:g=>j(o),onCancel:g=>E(o)},{default:a(()=>[r(y,{type:"primary",danger:""},{default:a(()=>[P(V(t.$t("shortUrl.delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])]),default:a(()=>[r(y,null,{icon:a(()=>[r(f(yt),{rotate:90})]),_:1})]),_:2},1032,["visible","onUpdate:visible"])])]),description:a(()=>[r(f(gt),{"result-desc":"",result:o.redirectUrl,"show-copy-button":!1},null,8,["result"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])])]),_:1},8,["spinning"])]),_:1})}}});const zt=St(Ot,[["__scopeId","data-v-c10461c3"]]);export{zt as default};
