import{d as q,cm as x,r as y,as as A,z as C,a as _,b as f,g as B,o as T,c as b,e as D,f as L,U as k,x as F,F as j,cU as z,ao as w,N as U,j as d}from"./index.954a2cbc.js";import{g as R}from"./getBase64.b1142636.js";import{_ as N}from"./multiImagePicker.vue_vue_type_script_setup_true_lang.1173f5b8.js";import{J as I}from"./jszip.min.e4a3ab7e.js";import"./_commonjs-dynamic-modules.30ae7933.js";var l=function(e){if(this.params=e,this.setImageType(),this.params.justConversion){this.responseData();return}this.quality=1,this.minMultiple=1,this.depPreprocessingFile=null;var t=this;switch(this.params.quality||(this.params.quality=.3),this.params.requestType){case"base64":if(this.calculatedSize(this.params.res)<=this.params.size*1024)return this.responseData(this.params.res);this.depPreprocessingFile=this.params.res,this.checkAndHandleUpload();break;case"file":case"blob":if(this.params.res.size<this.params.size*1024)return this.responseData(this.params.res);this.fileToBase64(this.params.res,function(a){t.depPreprocessingFile=a,t.checkAndHandleUpload()});break}};l.prototype.setImageType=function(){if(this.params.imgType)switch(this.params.requestType){case"base64":var e=this.params.res.split(","),t=e[0].match(/:(.*?);/)[1];this.params.res=this.params.res.replace(t,this.params.imgType);break;case"file":this.params.fileName||(this.params.fileName=this.params.res.name.slice(0,/\.{1}[a-z]{1,}$/.exec(this.params.res.name).index));case"blob":this.params.res.type=this.params.imgType;break}};l.prototype.responseData=function(e){var t=this,a=this.params.requestType,s=this.params.responseType;if(this.minMultiple>1&&(a="base64"),a===s){this.params.callback(e||this.params.res);return}var i=a+"To"+s.charAt(0).toUpperCase()+s.slice(1),r={base64ToFile:this.base64ToFile.bind(this),base64ToBlob:this.base64ToBlob.bind(this),fileToBase64:this.fileToBase64.bind(this),fileToBlob:this.fileToBlob.bind(this),blobToBase64:this.blobToBase64.bind(this),blobToFile:this.blobToFile.bind(this)};r[i](e||this.params.res,function(o){t.params.callback(o)})};l.prototype.calculatedSize=function(e){var t="base64",a=e.substring(e.indexOf(t)+t.length),s=a.indexOf("=");a=s!==-1?a.substring(0,s):a;var i=a.length;return i-i/8*2};l.prototype.checkAndHandleUpload=function(){var e=this;try{var t=new Image;t.src=this.depPreprocessingFile,t.onload=function(){var a=document.createElement("canvas"),s=a.getContext("2d"),i=e.params.width||this.width;a.width=i,a.height=e.params.height||this.height*(i/this.width),s.clearRect(0,0,a.width,a.height),s.drawImage(t,0,0,a.width,a.height);var r=a.toDataURL("image/jpeg",e.quality),o=e.calculatedSize(r);if(e.minMultiple+=1,o<e.params.size*1024)e.responseData(r);else{if(e.quality>e.params.quality)e.quality===1&&(e.depPreprocessingFile=r),e.quality-=e.params.quality;else{e.responseData(r);return}if(e.minMultiple>25){e.responseData(r);return}e.checkAndHandleUpload()}}}catch{this.params.callback(null)}};l.prototype.base64ToFile=function(e,t){for(var a=e.split(","),s=a[0].match(/:(.*?);/)[1],i=s.split("/")[1],r=atob(a[1]),o=r.length,m=new Uint8Array(o);o--;)m[o]=r.charCodeAt(o);t(new File([m],(this.params.fileName||"file")+"."+i,{type:s}))};l.prototype.base64ToBlob=function(e,t){var a=e.split(","),s="",i="";a.length>1&&(i=a[1],s=a[0].substring(a[0].indexOf(":")+1,a[0].indexOf(";")));for(var r=atob(i),o=new ArrayBuffer(r.length),m=new Uint8Array(o),n=0;n<r.length;n++)m[n]=r.charCodeAt(n);t(new Blob([o],{type:s}))};l.prototype.fileToBase64=function(e,t){var a=new FileReader;a.readAsDataURL(e),a.onload=function(s){t(this.result)}};l.prototype.fileToBlob=function(e,t){var a=this;this.fileToBase64(e,function(s){a.base64ToBlob(s,function(i){t(i)})})};l.prototype.blobToBase64=function(e,t){this.fileToBase64(e,t)};l.prototype.blobToFile=function(e,t){this.fileToBlob(e,function(a){t(a)})};var O=l;const E=q({__name:"index",setup(e){const{t}=x(),a=y(),s=A(()=>{var n;return(n=a.value)==null?void 0:n.fileList}),i=y(!1),r=y("image/jpeg"),o=C(["image/jpeg","image/png","image/gif","image/bmp","image/webp","image/avif","image/tiff"]),m=()=>{if(!s.value.length){w.warn(t("image.imageChoose"));return}i.value=!0;const n=new I;new Promise((c,u)=>{let h=0;for(const g of s.value)R(g).then(v=>{new O({res:v,justConversion:!0,requestType:"base64",responseType:"file",imgType:r.value,fileName:g.name.split(".")[0],callback:p=>{if(p===null){w.error(t("image.imageError")),i.value=!1;return}h++,n.file(`${p.name}`,p),h===s.value.length&&s.value.length===1&&c(p),h===s.value.length&&c(0)}})})}).then(c=>{if(s.value.length)if(s.value.length===1){const u=URL.createObjectURL(c);U.handleDownload(u)}else n.generateAsync({type:"blob"}).then(u=>{const h=URL.createObjectURL(u);U.handleDownload(h)});else{w.warn(t("image.imageChoose"));return}i.value=!1})};return(n,c)=>{const u=d("a-select-option"),h=d("a-select"),g=d("a-button"),v=d("a-space");return T(),_(B(z),{"right-width":200},{one:f(()=>[b(B(N),{ref_key:"imageRef",ref:a},null,512)]),two:f(()=>[b(v,{direction:"vertical"},{default:f(()=>[b(h,{value:r.value,"onUpdate:value":c[0]||(c[0]=p=>r.value=p),style:{width:"120px"}},{default:f(()=>[(T(!0),D(j,null,L(o,p=>(T(),_(u,{key:p,value:p},{default:f(()=>[k(F(p.split("/")[1]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),b(g,{type:"primary",loading:i.value,onClick:m},{default:f(()=>[k(F(n.$t("imageConvertor.converter")),1)]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{E as default};
